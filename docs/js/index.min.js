/*!
 * Start Bootstrap - SB Admin 2 v4.1.4 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2021 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

let gradeStrs=["1.0","1.3","1.7","2.0","2.3","2.7","3.0","3.3","3.7","4.0","4.3","4.7","5.0"],gradeStrs4=["1.0","1.3","1.4","1.7","2.0","2.3","2.4","2.7","3.0","3.3","3.4","3.7","4.0","4.3","4.7","5.0"],ectsCard=document.getElementById("ects-card-text"),ectsProgressBar=document.getElementById("ects-progress-bar"),gradeCard=document.getElementById("grade-card-text"),zscoreCard=document.getElementById("zscore-card-text"),percentileCard=document.getElementById("percentile-card-text");$.getJSON("js/agg_data.json",function(e){ectsCard.textContent=e.total_ects,ectsProgressBar.style.width=(100*e.total_ects/180|0)+"%",$("#ects-progress-bar").attr("aria-valuenow",""+e.total_ects),gradeCard.textContent=e.avg_grade.toFixed(2),zscoreCard.textContent=e.mean_z_score.toFixed(2),percentileCard.textContent=e.avg_percentile.toFixed(2)+"%"}),$.getJSON("js/semester_data.json",function(e){var t=document.getElementById("semester-linechart-canvas");let a=[],r=[],s;var o,d=["#00796B","#FFC107","#B2DFDB","#757575","#F8BBD0"];let n=0;for(o in e)"semester_code"===o?s=e[o]:(color=d[n++],a.push({label:o,data:e[o],yAxisID:o,fill:!1,backgroundColor:color,borderColor:color}),r.push({id:o,type:"linear",display:!1,stacked:!1,gridLines:{display:!1}}));new Chart(t,{type:"line",data:{labels:s,datasets:a},options:{responsive:!0,interaction:{mode:"index",intersect:!1},maintainAspectRatio:!1,stacked:!1,scales:{xAxes:[{gridLines:{display:!1,drawBorder:!1}}],yAxes:r},legend:{display:!0},tooltips:{callbacks:{label:function(e,t){let a=e.yLabel,r=t.datasets[e.datasetIndex].label||"";return r&&(r+=": "),r+=a%1==0?a:a.toFixed(2),r}}}}})});let charts={},gradeList=[],row=document.getElementById("bar-charts-row");function hideAllCheckmarks(){[].forEach.call(document.querySelectorAll(".sorting-checkmark"),function(e){e.style.visibility="hidden"})}function sortClick(e,t){for(var a in hideAllCheckmarks(),e.getElementsByClassName("sorting-checkmark")[0].style.visibility="visible",gradeList.sort(t),gradeList)row.appendChild(charts[gradeList[a].id])}function setUpSorting(e,t){e.onclick=()=>sortClick(e,t)}$.getJSON("js/grade_data.json",function(m){gradeList=m;let p=document.getElementById("template-bar-chart");for(var C in m){let e=m[C];var y=e.grade;let t=p.cloneNode(!0);t.id=e.id;let a=t.getElementsByClassName("course-name")[0];a.textContent=e.course_name_en;let r=t.getElementsByClassName("course-grade")[0];r.textContent=y;let s=t.getElementsByClassName("ects-text")[0];s.textContent=e.ects+" ECTS";let o=t.getElementsByClassName("semester-text")[0];o.textContent=e.semester_name_en;let d=t.getElementsByClassName("z-score-text")[0];d.textContent="Z-Score: "+e.z.toFixed(2);let n=t.getElementsByClassName("percentile-text")[0];n.textContent=e.percentile.toFixed(2)+" percentile",charts[e.id]=t,row.appendChild(t);C=t.getElementsByTagName("canvas");let l=e[1.4]||e[2.4]||e[3.4]?gradeStrs4:gradeStrs;var u,y=l.indexOf(y);let i=[];for(u in l)i.push(e[l[u]]);let c=Array(l.length).fill("#adb5bd");c[y]="#20c997";let g=Array(l.length).fill("#B2DFDB");g[y]="#17a2b8";new Chart(C,{type:"bar",data:{labels:l,datasets:[{label:"Number of students with grade",backgroundColor:c,hoverBackgroundColor:g,borderColor:"#0065BD",data:i}]},options:{maintainAspectRatio:!1,layout:{padding:{left:10,right:25,top:25,bottom:0}},scales:{xAxes:[{gridLines:{display:!1,drawBorder:!1}}]},legend:{display:!1},tooltips:{titleMarginBottom:10,titleFontColor:"#6e707e",titleFontSize:14,backgroundColor:"rgb(255,255,255)",bodyFontColor:"#858796",borderColor:"#dddfeb",borderWidth:1,xPadding:15,yPadding:15,displayColors:!1,caretPadding:10}}})}p.remove()}),$.getJSON("js/personal_distribution.json",function(e){var t=document.getElementById("personal-distribution-barchart-canvas"),a=gradeStrs,r=Array(a.length).fill("#20c997"),s=Array(a.length).fill("#17a2b8");new Chart(t,{type:"bar",data:{labels:a,datasets:[{label:"Relative part of this grade",backgroundColor:r,hoverBackgroundColor:s,borderColor:"#0065BD",data:e}]},options:{maintainAspectRatio:!1,layout:{padding:{left:10,right:25,top:25,bottom:0}},scales:{xAxes:[{gridLines:{display:!1,drawBorder:!1}}]},legend:{display:!1},tooltips:{callbacks:{label:function(e,t){let a=t.datasets[e.datasetIndex].label||"";return a&&(a+=": "),a+=e.yLabel.toFixed(2),a}}}}})});let sortGradeDesc=document.getElementById("sort-grade-descending");setUpSorting(sortGradeDesc,(e,t)=>t.int_grade_X10-e.int_grade_X10);let sortGradeAsc=document.getElementById("sort-grade-ascending");setUpSorting(sortGradeAsc,(e,t)=>100*(e.int_grade_X10-t.int_grade_X10)+t.ects-e.ects);let sortDateAsc=document.getElementById("sort-date-ascending");setUpSorting(sortDateAsc,(e,t)=>e.grade_date.localeCompare(t.grade_date));let sortDateDesc=document.getElementById("sort-date-descending");setUpSorting(sortDateDesc,(e,t)=>t.grade_date.localeCompare(e.grade_date));let sortECTSAsc=document.getElementById("sort-ects-ascending");setUpSorting(sortECTSAsc,(e,t)=>e.ects-t.ects);let sortECTSDesc=document.getElementById("sort-ects-descending");setUpSorting(sortECTSDesc,(e,t)=>t.ects-e.ects);